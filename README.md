# Calculator
Calculator

# Calculator
Calculator

В данном репозитории находится программа по сбору информации из справочников на основе определенной логики, для дальнейшего формирования и анализа полученных данных.
Из соображения безопасности файлы, пароли, часть рабочего окружения не были добавлены в репозиторий.

План описания программы:

1. Общая цель программы.
2. Разбор входных и выходных данных. Логика работы программы.
3. Описание системных файлов.
4. Описание логики классов.
5. Описание выходного файла.


1. Общая цель программы.

Если говорить простым языков программа выполняет задачи сортировки, группировки и формирования информации из заданных файлов c расширением .xlsx или .xlsm в выходной файл. Файлы от куда берется информация и производится поиск называются справочниками. Поиск производится по ключевым словам. На выходе формируется файл с собранной информацией по всем нужным справочникам.

2. Разбор входных и выходных данных. Логика работы программы. 

Файл с расширением .xlsx, он же и выходной файл.
Справочники: Свод, Архив, Закупки_ЗИП, Категоризатор, Коллизии, Статусы_архива.

Входные данные:

Поиск по справочникам и формирование выходного файла производится по партийнику(строка) из колонки "P/N", который мы берем из входного файла. Также для поиска и обработки исключений мы берем информация из ключевых колонок:

"Заказчик" - str
"Вендор" - str
"P/N" - str/int
"Описание" - str
"Количество" - int

Данные собираются в кортеж по каждой строке из вышеописанных колонок и добавляются в список.

Для каждого парйтийника кортеж выглядит так: item_tuple = (part_number, amount, description, vendor, name)

Далее добавляем в список: list_item.append(item_tuple)


Логика работы:

Для поиска и формирования справочников мы будем использовать dict - словари.


Создадим функцию чтобы оставить только буквы и цифры в партийнике. Ключом в выходном словаре будет отфильтрованный партийник.

Модуль excel.py функция --> def filterkey(self, key):


Формирование справочников:
Формирование справочников происходит по заранее заданным колонкам из таких же файлов excel.

--Формируем Свод.

Модуль excel.py функция --> def archcreation(self, archmybook):



--Формируем Закупки_ЗИП, страницу "Закупается".

Модуль excel.py функция --> def purchasesearch_one(self, purchasebook):



--Формируем Закупки_ЗИП, страницу "Хотим".

Модуль excel.py функция --> def purchasesearch_two(self, purchasebook):


           
--Формируем Статусы_Архива.

Модуль excel.py функция --> def orderstatus(self, num_order, orderbook) -> bool:
        
        
--Формируем архив.

Модуль excel.py функция --> def archivecreation(self, archivebook, orderbook, category):
        
        
        
--Формируем словарь исключений по описанию.

Модуль excel.py функция --> def categorydescription(self, param: str, book, category_book):
           
           
           
Формирование и заполнение данных выполняется на основе двух словарей.

item: dict = {} - временный словарь для заполнения всей информации по партийнику.
finaldict: dict = {} - конечный словарь, где ключ:[партийник] = значение:[item: dict]


Модуль main.py функция --> def final_compilate(purchase_book, 
                                              archivebook,
                                              categorybook,
                                              orderbook,
                                              archmybook,
                                              collisionbook,
                                              e: excel.Excel, archdict: dict,
                                              archivedick: dict,
                                              purchase_one_dict: dict,
                                              purchase_two_dict: dict,
                                              my_mail: mail.Attachmail):
                                              
                                              
Функция def final_compilate(...): формирует конечный словарь на основе которого формируется файл Final.json.
Также функция отвечает за формирование и выполнения всей программы в целом. Все ключевые этапы находятся в этой функции.
Файл Final.json можно посмотреть в аттаче на главной странице репозитория. Так выглядит конечное дерево элементов.



3. Описание системных файлов.

.gitignore - Файлы, которые git не добавляет в репозиторий, но они находятся локально на устройстве.

Final.json - Финальное дерево компонентов.

config.py - Данные для переменного окружения.

excel.py - Класс для работы с Excel.

mail.py - Класс для работы с Mail.

unicode.py - Опциональный класс.

main.py - Финальный модуль. Формирующий.

lib_checkmail.py - Модуль библиотек для класса Mail.

lib_excel.py - Модуль библиотек для класса Excel.

lib_main.py - Модуль библиотек для финального модуля.

requirements.txt - Все библиотеки.


4. Описание логики классов.

Класс Excel. Исполняемый модуль excel.py.
Формирование справочников в этом разделе представлено не будет, так как они были описаны выше. Формирование справочников входит в класс excel.

Функция def load_book(self, dir): --> Загружает книгу.

Функция def isParametr(self, sheetname): --> Поиск нужных 5 колонок и формирование списка кортежей по строкам.

Функция def categoryarch(self, key, categorybook): --> Поиск категории.

Функция def categorydescription(self, param: str, book, category_book): --> Поиск исключений по описанию.

Функция def searchebay(self, key): --> Поиск Ebay по минимальной цене.

Функция def nowritercatebay(self, item: dict, key): --> Поиск исключений по категориям.

Функция def categoryfinal(self, param, categoryybook): --> Запись финальной категории.

Функция def archivefinding(self, local_key, 
                       archive_dict, category_book, main_key): --> Поиск по архиву.
                       
Функция def writing(self, item_dict: dict, ws, 
                appoint: str, book: str, 
                event: str, l_count: int, 
                localKey, mainkey,
                list_item: list): --> запись данных в шаблон.
                
Функция def collision(self, key, vendor): --> Проверяет партийник на наличие краевых ситуаций.

Функция def listadd(self, title: list): --> Опциональная функция.



Класс AttachMail. Исполняемый модуль mail.py.
Данный класс отвечает за подключение, проверку, работу с почтой.

Функция def __init__(self, mail_server: str, 
                 username: str, 
                 password: str
                 ): --> Инициализирует объект.
                 
Функция def close_connection(self): --> Закрывает подключение.

Функция def search_count_messages_dir(self, dir: str): --> Считает количество писем.

Функция def parse_uid(self, data: str): --> Парсит UID письма.

Функция def send_email(self, user: str, 
                   pwd: str, 
                   recipient: str, 
                   subject: str, 
                   body: str,
                   file = None,
                   isTls=True,
                   filename = None): --> Отправка письма.
                   
Функция def get_attachments(self, attachment_dir: str,
                        e): --> Извлечение вложений из письма и сохранение на комп.
                        

Класс UnicodeReader. Исполнаемый модуль unicode.py.

Функция def encoded(self, words: str): --> декодирует UTF-8.


5. Описание выходного файла.

Тестовые файлы находятся в папке https://github.com/Disprice67/Calculator/tree/master/TestFile

TestIn - Пример входного файла. Вся информация собирается из вышеописанных 5 колонок и добавляется в список.

TestOut - Пример выходного файла. Как мы видим в выходном файле добавляются новые колонки от столбца F до W. Название этих колонок стандартное, также как и стилистика (шрифт, закраска заднего фона, толщина букв и тд.) Названия столбцов сохранены как константы.

Описание 1 страницы:

['Расчет']

В столбцы от F до W добавляется информация, которая была собрана в следствие выполнения программы (поиска по всем справочникам). Всю информацию мы берем по каждому партийнику из словаря final: dict, передаем его как аргумент в функцию def writing(...): Запись всей информации осуществляется в шаблон, по-мимо найденной информации в справочнике, мы также записываем информацию из кортежа по каждому партийнику (парт-номер, описание и тд).

Описание 2 страницы:

['Оценка рыночной стоимости']

Показатели на данной страницы просчитываются на основе шаблона, в каждой ячейки на этой страницы есть опеределенная формула, которая берет информацию со страницы ['Расчет'], формулы добавляются и изменяются через шаблон, уже в готовый шаблон записывается вся вышеперечисленная информация.

Описание 3 страницы:

['Для архива']

На данной странице собирается информация для переноса ее в архив, вся собранная информация должна быть в определенном формате. В каждой ячейке своя формула, которая берем данные со страницы ['Расчет'], формулы и формат страницы регулируется через шаблон.


Робот работает через почту, входной файл приходит на почту, скачивается, обрабатывается, затем уже выходной файл прошедший все этапы формирования отсылается на почту отправителя первоначального письма. В отправленном письме присутствуют дисклеймеры. Количество и описания дисклеймера напрямую зависят от параметров на страницы ['Оценка рыночной стоимости']. Пример письма находится здесь:https://github.com/Disprice67/Calculator/tree/master/TestFile, файл Test.png.


